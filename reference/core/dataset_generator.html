

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DatasetGenerator Class &mdash; SpiegeLib 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SoundMatch Class" href="sound_match.html" />
    <link rel="prev" title="AudioBuffer Class" href="audio_buffer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> SpiegeLib
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../core.html">Core</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="audio_buffer.html">AudioBuffer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">     DatesetGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="sound_match.html">SoundMatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Utility Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../synth.html">Synth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Audio Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../estimators.html">Estimators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../evaluation.html">Evaluation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_index.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contribution Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SpiegeLib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../core.html">SpiegeLib Core Classes</a> &raquo;</li>
        
      <li>DatasetGenerator Class</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/reference/core/dataset_generator.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-spiegelib.core.dataset_generator">
<span id="datasetgenerator-class"></span><span id="dataset-generator"></span><h1>DatasetGenerator Class<a class="headerlink" href="#module-spiegelib.core.dataset_generator" title="Permalink to this headline">¶</a></h1>
<p>This class can be used to generate datasets from instances of synthesizers. This is
useful for creating large sets of data for training and validating deep learning models.</p>
<p class="rubric">Examples</p>
<p>Example generating 50000 training samples and 10000 testing samples from the
<em>Dexed</em> VST FM Synthesizer. Each sample is created by creating a random
patch configuration in <em>Dexed</em>, and then rendering a one second audio clip of
that patch. A 13-band MFCC is computed on the resulting audio. These audio features
and the synthesizer parameters used to synthesize the audio are saved in numpy files.
Audio features are normalized by removing the mean and scaling to unit variance. The
values used for normalization are saved after the first dataset generation so they
can be used on future data.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spiegelib</span> <span class="k">as</span> <span class="nn">spgl</span>

<span class="n">synth</span> <span class="o">=</span> <span class="n">spgl</span><span class="o">.</span><span class="n">synth</span><span class="o">.</span><span class="n">SynthVST</span><span class="p">(</span><span class="s2">&quot;/Library/Audio/Plug-Ins/VST/Dexed.vst&quot;</span><span class="p">,</span>
                            <span class="n">note_length_secs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                            <span class="n">render_length_secs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># Mel-frequency Cepstral Coefficients audio feature extractor.</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">spgl</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">MFCC</span><span class="p">(</span><span class="n">num_mfccs</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">frame_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
                              <span class="n">hop_size</span><span class="o">=</span><span class="mi">1024</span> <span class="n">time_major</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Setup generator for MFCC output and generate 50000 training examples</span>
<span class="c1"># and 10000 testing examples</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">spgl</span><span class="o">.</span><span class="n">DatasetGenerator</span><span class="p">(</span><span class="n">synth</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span>
                                  <span class="n">output_folder</span><span class="o">=</span><span class="s2">&quot;./data_FM_mfcc&quot;</span><span class="p">,</span>
                                  <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">50000</span><span class="p">,</span> <span class="n">file_prefix</span><span class="o">=</span><span class="s2">&quot;train_&quot;</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">file_prefix</span><span class="o">=</span><span class="s2">&quot;test_&quot;</span><span class="p">)</span>
<span class="n">generator</span><span class="o">.</span><span class="n">save_normalizers</span><span class="p">(</span><span class="s1">&#39;normalizers.pkl&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<dl class="class">
<dt id="spiegelib.DatasetGenerator">
<em class="property">class </em><code class="sig-prename descclassname">spiegelib.</code><code class="sig-name descname">DatasetGenerator</code><span class="sig-paren">(</span><em class="sig-param">synth</em>, <em class="sig-param">features</em>, <em class="sig-param">output_folder='/Users/jshier/Development/Academic/spiegel/docs'</em>, <em class="sig-param">save_audio=False</em>, <em class="sig-param">normalize=False</em><span class="sig-paren">)</span><a class="headerlink" href="#spiegelib.DatasetGenerator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>synth</strong> (<em>Object</em>) – Synthesizer to generate test data from. Must inherit from
<a class="reference internal" href="../synth/synth_base.html#spiegelib.synth.SynthBase" title="spiegelib.synth.SynthBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">spiegelib.synth.SynthBase</span></code></a>.</p></li>
<li><p><strong>features</strong> (<em>Object</em>) – Features to use for dataset generation. Must inherit from
<code class="xref py py-class docutils literal notranslate"><span class="pre">spiegelib.features.FeaturesBase</span></code>.</p></li>
<li><p><strong>output_folder</strong> (<em>str</em><em>, </em><em>optional</em>) – Output folder for dataset, defaults to currect working directory.</p></li>
<li><p><strong>save_audio</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether or not to save rendered audio files, defaults to False.</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether or not to normalize resulting feature vector. If the feature
object does not have normalizers set, then this will train normalizers based on the
generated dataset and store them in the features object. Call <a class="reference internal" href="#spiegelib.DatasetGenerator.save_normalizers" title="spiegelib.DatasetGenerator.save_normalizers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_normalizers()</span></code></a>
to store normalization settings. Defaults to False.</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="spiegelib.DatasetGenerator.features_filename">
<code class="sig-name descname">features_filename</code><a class="headerlink" href="#spiegelib.DatasetGenerator.features_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>filename for features output file, defaults to features.npy</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="spiegelib.DatasetGenerator.patches_filename">
<code class="sig-name descname">patches_filename</code><a class="headerlink" href="#spiegelib.DatasetGenerator.patches_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>filename for patches output file, defaults to patches.npy</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="spiegelib.DatasetGenerator.audio_folder_name">
<code class="sig-name descname">audio_folder_name</code><a class="headerlink" href="#spiegelib.DatasetGenerator.audio_folder_name" title="Permalink to this definition">¶</a></dt>
<dd><p>folder name for the audio output if used. Will be automatically
created within the output folder if saving audio. Defaults to audio</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="spiegelib.DatasetGenerator.generate">
<code class="sig-name descname">generate</code><span class="sig-paren">(</span><em class="sig-param">size</em>, <em class="sig-param">file_prefix=''</em>, <em class="sig-param">fit_normalizers_only=False</em><span class="sig-paren">)</span><a class="headerlink" href="#spiegelib.DatasetGenerator.generate" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate dataset with a set of random patches. Saves the extracted features
and parameter settings in separate .npy files. Files are stored in the output
folder set during construction (defaults to current working directory) and
saves the features as “features.npy” and patches as “patches.npy”. These file
names can be prefixed with a string set by the file_prefix argument. If audio
files are being saved (configured during construction), then the audio files
are saved in a separate audio folder and all audio files are also prefixed
by the file_prefix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>size</strong> (<em>int</em>) – Number of different synthesizer patches to render.</p></li>
<li><p><strong>file_prefix</strong> (<em>str</em><em>, </em><em>optional</em>) – filename prefix for all output data.</p></li>
<li><p><strong>fit_normalizers_only</strong> (<em>bool</em><em>, </em><em>optional</em>) – If this is set to True, then
no data will be saved and only normalizers will be set or reset
for the feature object.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="spiegelib.DatasetGenerator.save_normalizers">
<code class="sig-name descname">save_normalizers</code><span class="sig-paren">(</span><em class="sig-param">file_name</em><span class="sig-paren">)</span><a class="headerlink" href="#spiegelib.DatasetGenerator.save_normalizers" title="Permalink to this definition">¶</a></dt>
<dd><p>Save feature normalizers also a pickle file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_name</strong> (<em>str</em>) – file name for normalizer pickle file</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sound_match.html" class="btn btn-neutral float-right" title="SoundMatch Class" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="audio_buffer.html" class="btn btn-neutral float-left" title="AudioBuffer Class" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, University of Victoria

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>